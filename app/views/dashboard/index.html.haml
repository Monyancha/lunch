- @page_title = t('dashboard.meta_title')
.dashboard.row
  .column-3
    =render layout: 'dashboard/dashboard_module', locals: {title: t('dashboard.market_overview.title'), classes: 'dashboard-module-market'} do
      .dashboard-market-graph{data: {:'graph-series' => @market_overview.to_json}}
    =render layout: 'dashboard/dashboard_module', locals: {title: t('dashboard.your_account.title'), classes: ['dashboard-module-your-account']} do
      .dashboard-pledged-collateral
        %h2= t('dashboard.your_account.pledged_collateral.title')
        .dashboard-bar-graph
          - mortgage_percentage = number_to_percentage(@pledged_collateral[:mortgages][:percentage], precision: 1)
          - agency_percentage = number_to_percentage(@pledged_collateral[:agency][:percentage], precision: 1)
          - aaa_percentage = number_to_percentage(@pledged_collateral[:aaa][:percentage], precision: 1)
          - aa_percentage = number_to_percentage(@pledged_collateral[:aa][:percentage], precision: 1)
          .mortgages-bar.bar-graph-section{style: "width: #{mortgage_percentage}"}
            .inner-bar
            .tooltip
              %span= number_to_human(@pledged_collateral[:mortgages][:absolute], units: 'global.currency')
              %span= mortgage_percentage
          .agency-bar.bar-graph-section{style: "width: #{agency_percentage};"}
            .inner-bar
            .tooltip
              %span= number_to_human(@pledged_collateral[:agency][:absolute], units: 'global.currency')
              %span= agency_percentage
          .aaa-bar.bar-graph-section{style: "width: #{aaa_percentage};"}
            .inner-bar
            .tooltip
              %span= number_to_human(@pledged_collateral[:aaa][:absolute], units: 'global.currency')
              %span= aaa_percentage
          .aa-bar.bar-graph-section{style: "width: #{aa_percentage};"}
            .inner-bar
            .tooltip
              %span= number_to_human(@pledged_collateral[:aa][:absolute], units: 'global.currency')
              %span= aa_percentage
        .labels
          %span.mortgages-label= t('dashboard.your_account.pledged_collateral.mortgages')
          %span.securities-label= t('dashboard.your_account.pledged_collateral.securities')
      .dashboard-total-securities-graph
      .dashboard-effective-borrowing-capacity-graph
      .dashboard-anticipated-activity-graph
        %h2= t('dashboard.your_account.anticipated_activity.title')
        =image_tag('anticipated-activity.png', alt: 'Anticipated Activity Graph')
      %table.dashboard-account-breakdown-table
        %tbody
          - @account_overview.each do |row|
            %tr
              %td.label #{row[0]}
              %td.currency $
              %td.value #{number_with_delimiter(row[1], precision: 0)}
          - @sub_tables.each do |sub_table_name, sub_table|
            %tr
              %td{colspan: '3'}
                %table.sub-table
                  %thead
                    %tr
                      %th.label{colspan: '3'}= t("dashboard.your_account.table.#{sub_table_name}.title") #note that the key names in our locale/en.yml file must match the key names in the @sub_tables hash
                  %tbody
                    - sub_table.each do |row|
                      %tr
                        %td.label #{row[0]}
                        %td.currency $
                        %td.value #{number_with_delimiter(row[1], precision: 0)}
  .column-3
    =render layout: 'dashboard/dashboard_module', locals: {title: t('dashboard.quick_advance.title'), classes: 'dashboard-module-advances'} do
      = render 'shared/input_field', icon: :dollar, placeholder: t('dashboard.quick_advance.advance_placeholder')
      %p= t('global.vrc_overnight')
      .dashboard-advances-rate
        0.14
        %span<> %
    =render layout: 'dashboard/dashboard_module', locals: {title: t('dashboard.previous_activity.title'), action_type: 'more-button'} do
      %table.table-striped
        %tbody
          - @previous_activity.each_with_index do |row, i|
            %tr
              %td
                #{row[0]}
                %div.dashboard-module-content-light #{row[2].strftime('%^b %d %Y')}
              - if i == 0
                %td #{number_to_currency(row[1], precision: 0)}
              - else
                %td #{number_with_delimiter(row[1], precision: 0)}
    =render layout: 'dashboard/dashboard_module', locals: {title: t('dashboard.anticipated_activity.title'), action_type: 'calendar-icon'} do
      %table.table-striped
        %tbody
          - @anticipated_activity.each_with_index do |row, i|
            - if row[1].nil?
              - sgn = t('global.na')
            - elsif row[1] > 0
              - sgn = '+'
            - else
              - sgn = ''
            %tr
              %td
                #{row[0]}
                %div.dashboard-module-content-light #{row[2].strftime('%^b %d %Y')}
              - if i == 0
                %td
                  #{sgn}#{number_to_currency(row[1], precision: 0)}
                  %div.dashboard-module-content-light #{row[3].upcase}
              - else
                %td
                  #{sgn}#{number_with_delimiter(row[1], precision: 0)}
                  %div.dashboard-module-content-light #{row[3].upcase}
  .column-3
    =render layout: 'dashboard/dashboard_module', locals: {title: 'Example Module 4', action_type: 'edit-button'} do
      %p This is content that should be yielded inside the dashboard module.
      %p This will give us flexibility to put whatever we want inside.
    = render layout: 'dashboard/dashboard_module', locals: {title: t('dashboard.contacts.title'), classes: 'dashboard-module-contact'} do
      %ul
        %li= render 'dashboard/dashboard_contact', email: 'user@example.com', title: t('dashboard.contacts.type.nonstandard_advance'), name: 'Bob – RM', phone_number: '415–555–7283'
        %li= render 'dashboard/dashboard_contact', email: 'otheruser@example.com', title: t('dashboard.contacts.type.general'), name: 'Teresa – FHLB Desk', phone_number: '415–555–7283'
      = render 'shared/input_field', icon: :magnify, placeholder: t('dashboard.contacts.search_placeholder')