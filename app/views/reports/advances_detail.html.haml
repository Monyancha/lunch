- @html_class = 'white-background'
- @page_title = t('reports.meta_title')
- deferred_load = @advances_detail[:deferred]
.report.advances-detail-report.row{data: {deferred: @job_status_url, 'deferred-load' => @load_url}}
  .report-header
    %h1= @report_name
    - if @print_layout
      = render 'print_details', name: @member_name, date: t('datepicker.single.input', date: fhlb_date_standard_numeric(@start_date))
    - else
      = render 'reports_header_buttons', allowed_params: :start_date, download_formats: [:pdf, :xlsx]
      = render 'report_details', name: @member_name, freshness: t('reports.freshness.previous_day'), availability: t('reports.availability.months', months: 18)
    .report-inputs
      = render 'reports_date_picker_form', start_date: @start_date, report_url: reports_advances_url, presets: @picker_presets, single_date_picker: true, min_date: @min_date, max_date: @max_date
  .report-main-body
    .report-summary-data
      %h3
        = report_summary_with_date('reports.pages.advances_detail.total_current_par_heading', fhlb_date_long_alpha(@start_date))
      %p{class: ('report-summary-data-loading' if deferred_load)}= (fhlb_formatted_currency_whole(@advances_detail[:total_par], force_unit: true) unless deferred_load)
    %h2.report-table-title= t('reports.pages.advances_detail.title', date: fhlb_date_standard_numeric(@start_date))
    %table.table-allow-wrapping.report-table.advances-details-report-table{data: {sortable: !deferred_load, loaded: !deferred_load, :'disable-auto-width' => true, :'missing-data-message' => missing_data_message}, class: ('table-loading' if deferred_load)}
      %thead
        %tr
          %th.report-cell-narrow= t('common_table_headings.trade_date')
          %th.report-cell-narrow= t('common_table_headings.funding_date')
          %th.report-cell-narrow= t('common_table_headings.maturity_date')
          %th.report-cell-narrow= t('common_table_headings.advance_number')
          %th.report-cell-narrow= t('common_table_headings.advance_type')
          %th.report-cell-narrow= fhlb_add_unit_to_table_header(t('common_table_headings.current_par'), '$')
          %th.report-cell-narrow{class: ('report-cell-right' if @print_layout)}= fhlb_add_unit_to_table_header(t('common_table_headings.interest_rate'), '%')
          %th.report-cell-narrow= t('reports.pages.advances_detail.next_interest_payment_date')
          %th.report-cell-narrow{class: ('report-cell-right' if @print_layout)}= fhlb_add_unit_to_table_header(t('reports.pages.advances_detail.accrued_interest_heading'), '$')
          %th.report-cell-narrow{class: ('report-cell-right' if @print_layout)}= fhlb_add_unit_to_table_header(t('reports.pages.advances_detail.estimated_next_payment_table_heading'), '$')
          - if @print_layout
            %th.report-cell-narrow.report-cell-right= fhlb_add_unit_to_table_header(t('reports.pages.advances_detail.prepayment_fee_indication'), '$')
          - else
            %th.report-cell-narrow{data: {unsortable: true}}= t('global.details')
            %th
      - if deferred_load
        %tbody
          = render 'deferred_table_row', colspan: 12
      - else
        %tbody
          - @advances_detail[:advances_details].to_a.each_with_index do |row, index|
            %tr
              %td.report-cell-narrow= fhlb_date_standard_numeric(row[:trade_date]) if row[:trade_date]
              %td.report-cell-narrow= fhlb_date_standard_numeric(row[:funding_date]) if row[:funding_date]
              %td.report-cell-narrow= row[:maturity_date].blank? ? t('global.open') : fhlb_date_standard_numeric(row[:maturity_date])
              %td.report-cell-narrow= row[:advance_number]
              %td.report-cell-narrow= row[:advance_type]
              %td.report-cell-narrow.report-cell-right= fhlb_formatted_number(row[:current_par]) if row[:current_par]
              %td.report-cell-narrow.report-cell-right= fhlb_formatted_number(row[:interest_rate], precision: 2)
              %td.report-cell-narrow= row[:next_interest_pay_date].blank? ? '-' : fhlb_date_standard_numeric(row[:next_interest_pay_date])
              %td.report-cell-narrow.report-cell-right= fhlb_formatted_number(row[:accrued_interest], precision: 2) if row[:accrued_interest]
              %td.report-cell-narrow.report-cell-right= row[:estimated_next_interest_payment].blank? ? '-' : fhlb_formatted_number(row[:estimated_next_interest_payment], precision: 2)
              - if @print_layout
                %td.report-cell-narrow.report-cell-right
                  = fhlb_formatted_number(row[:prepayment_fee_indication], optional_number: true, precision: 2)
                  = row[:prepayment_fee_indication_notes].html_safe if row[:prepayment_fee_indication_notes]
              - else
                %td.report-cell-narrow.report-cell-right.detail-view-trigger= t('global.view')
                %td.report-detail-cell{colspan: 11}
                  %h3= t('reports.pages.advances_detail.record_title', advance_number: row[:advance_number])
                  %p.hide-detail-view= t('global.hide')
                  .left-column
                    %table
                      %tr
                        %td= t('common_table_headings.trade_date')
                        %td= fhlb_date_standard_numeric(row[:trade_date]) if row[:trade_date]
                      %tr
                        %td= t('common_table_headings.funding_date')
                        %td= fhlb_date_standard_numeric(row[:funding_date]) if row[:funding_date]
                      %tr
                        %td= t('common_table_headings.maturity_date')
                        %td= row[:maturity_date].blank? ? t('global.open') : fhlb_date_standard_numeric(row[:maturity_date])
                    %table
                      %tr
                        %td= t('common_table_headings.advance_number')
                        %td= row[:advance_number]
                      %tr
                        %td= t('common_table_headings.advance_type')
                        %td= row[:advance_type]
                    %table
                      %tr
                        %td= t('common_table_headings.current_par')
                        %td= fhlb_formatted_currency_whole(row[:current_par]) if row[:current_par]
                    %table
                      %tr
                        %td= t('reports.pages.advances_detail.interest_payment_frequency')
                        %td= row[:interest_payment_frequency]
                      %tr
                        %td= t('reports.pages.advances_detail.day_count_basis')
                        %td= row[:day_count_basis]
                  .right-column
                    %table
                      %tr
                        %td= t('common_table_headings.interest_rate')
                        %td= row[:interest_rate]
                      %tr
                        %td= t('reports.pages.advances_detail.accrued_interest')
                        %td= fhlb_formatted_currency(row[:accrued_interest]) if row[:accrued_interest]
                    %table
                      %tr
                        %td= t('reports.pages.advances_detail.next_interest_payment_date')
                        %td= row[:next_interest_pay_date].blank? ? '-' : fhlb_date_standard_numeric(row[:next_interest_pay_date])
                      %tr
                        %td= t('reports.pages.advances_detail.estimated_next_payment')
                        %td= row[:estimated_next_interest_payment].blank? ? '-' : fhlb_formatted_currency(row[:estimated_next_interest_payment])
                    %table
                      %tr
                        %td= t('reports.pages.advances_detail.discount_program')
                        %td= row[:discount_program] || t('global.none')
                    %table
                      %tr
                        %td= t('reports.pages.advances_detail.prepayment_fee_indication')
                        %td
                          = fhlb_formatted_currency(row[:prepayment_fee_indication], optional_number: true)
                          = row[:prepayment_fee_indication_notes].html_safe if row[:prepayment_fee_indication_notes]
        %tfoot
          %tr
            %td.report-cell-narrow= t('global.totals')
            %td.report-cell-narrow{colspan: 4}
            %td.report-cell-narrow.report-cell-right= fhlb_formatted_currency_whole(@advances_detail[:total_par], force_unit: true)
            %td.report-cell-narrow{colspan: 2}
            %td.report-cell-narrow.report-cell-right= fhlb_formatted_currency(@advances_detail[:total_accrued_interest], force_unit: true)
            %td.report-cell-narrow.report-cell-right= fhlb_formatted_currency(@advances_detail[:estimated_next_payment], force_unit: true)
            %td.report-cell-narrow
    %small
      %p= t('reports.intraday_processing_notice')
      %p= t('reports.close_of_business_processing_notice')
      %dl
        %dt
          #{t('common_table_headings.maturity_date')}:
        %dd= t('reports.maturity_date_notice')
        %dt
          #{t('reports.pages.advances_detail.accrued_interest')}:
        %dd= t('reports.accrued_interest_notice')
        %dt
          #{t('reports.pages.advances_detail.estimated_next_payment')}:
        %dd= t('reports.estimated_next_interest_payment_notice')
        %dt
          #{t('reports.pages.advances_detail.prepayment_fee_indication')}:
        %dd= t('reports.prepayment_fee_notice', phone_number: service_desk_phone_number)
      %p
        = t('reports.merger_notice')
      %p
        = t('reports.advances_and_securities_agreement_notice', phone_number: operations_phone_number)
